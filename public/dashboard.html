<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard - EDGE VERTEX</title>
  <link rel="stylesheet" href="/styles/styles.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="dashboard-page layout-soft-bg">
  <!-- ===== Topbar fixa ===== -->
  <header class="header">
    <div class="header-logo">
      <img src="/assets/edge.png" alt="Edge" />
      <img src="/assets/vertex.png" alt="Vertex" style="margin-left:10px;height:40px;" />
    </div>
    <nav class="header-nav">
      <a href="/dashboard" class="nav-link active">Painel de Projetos</a>
      <a href="/login" class="nav-link">Login</a>
    </nav>
  </header>

  <!-- ===== Conte√∫do ===== -->
  <main class="dashboard-shell">
    <section class="dashboard-hero">
      <div class="dashboard-hero__info">
        <span class="dashboard-hero__eyebrow">Painel de Projetos</span>
        <h1 class="dashboard-hero__title">Projetos</h1>
        <p class="dashboard-hero__subtitle">
          Acompanhe os contratos ativos, atualize dados e acesse a presta√ß√£o de contas em poucos cliques.
        </p>
      </div>
      <div class="dashboard-hero__actions">
        <div class="search-field">
          <span class="search-field__icon" aria-hidden="true">üîç</span>
          <input type="text" id="project-search" placeholder="Buscar por nome do projeto ou c√≥digo" aria-label="Buscar projetos" />
        </div>
        <button class="btn btn-primary" id="btn-open-modal">+ Novo Projeto</button>
      </div>
    </section>

    <section class="dashboard-filters" aria-label="Filtrar projetos por status">
      <h2 class="dashboard-filters__title">Filtrar por status</h2>
      <div class="filter-group" role="toolbar">
        <button class="filter-btn active" data-filter="all" type="button">Todos</button>
        <button class="filter-btn" data-filter="em_andamento" type="button">Em andamento</button>
        <button class="filter-btn" data-filter="finalizado" type="button">Finalizado</button>
        <button class="filter-btn" data-filter="pendente" type="button">Pendente</button>
      </div>
    </section>

    <section class="projects-section">
      <header class="projects-section__head">
        <h2 class="projects-section__title">Projetos cadastrados</h2>
        <p class="projects-section__subtitle">Visualize o andamento e edite as informa√ß√µes de cada iniciativa.</p>
      </header>
      <div id="projects-grid" class="projects-grid"></div>
      <p id="empty-state" class="empty" hidden>Nenhum projeto encontrado.</p>
    </section>

    <!-- Modal: Editar Projeto -->
    <dialog id="project-edit-modal" class="modal">
      <form id="project-edit-form" method="dialog" class="modal__content">
        <div class="modal__header">
          <h2>Editar projeto</h2>
          <button type="button" class="icon-btn" id="project-edit-close" aria-label="Fechar">‚úï</button>
        </div>

        <input type="hidden" name="id" id="pe-id" />

        <div class="form-grid">
          <label class="field span-2">
            <span>T√≠tulo</span>
            <input type="text" name="titulo" id="pe-titulo" required />
          </label>

          <label class="field">
            <span>C√≥digo</span>
            <input type="text" name="codigo" id="pe-codigo" />
          </label>

          <label class="field">
            <span>Status</span>
            <select name="status" id="pe-status">
              <option value="em_andamento">Em andamento</option>
              <option value="finalizado">Finalizado</option>
              <option value="pendente">Pendente</option>
            </select>
          </label>

          <label class="field">
            <span>Vig√™ncia (in√≠cio)</span>
            <input type="month" name="vigenciaInicio" id="pe-vigini" />
          </label>

          <label class="field">
            <span>Vig√™ncia (fim)</span>
            <input type="month" name="vigenciaFim" id="pe-vigfim" />
          </label>

          <label class="field">
            <span>Institui√ß√£o</span>
            <select name="instituicao" id="pe-inst">
              <option value="EDGE">EDGE</option>
              <option value="VERTEX">VERTEX</option>
            </select>
          </label>

          <label class="field">
            <span>Gerente</span>
            <input type="text" name="gerente" id="pe-gerente" />
          </label>

          <label class="field">
            <span>Coordenador</span>
            <input type="text" name="coordenador" id="pe-coordenador" />
          </label>
        </div>

        <div class="row" style="justify-content: flex-end; gap: 8px; margin-top: 16px;">
          <button type="button" class="btn" id="project-delete">Excluir projeto</button>
          <button type="button" class="btn btn-ghost" id="project-cancel">Cancelar</button>
          <button type="submit" class="btn btn-primary" id="project-save">Salvar altera√ß√µes</button>
        </div>
      </form>
    </dialog>
  </main>
  <!-- ===== Modal Novo Projeto ===== -->
  <dialog id="project-modal" class="modal">
    <form id="project-form" method="dialog" class="modal__content">
      <div class="modal__header">
        <h2>Novo Projeto</h2>
        <button type="button" class="icon-btn" id="btn-close-modal" aria-label="Fechar">‚úï</button>
      </div>

      <div class="form-grid">
        <label class="field">
          <span>Nome do Projeto</span>
          <input name="titulo" type="text" required />
        </label>

        <label class="field">
          <span>Institui√ß√£o</span>
          <select name="instituicao" required>
            <option value="EDGE" selected>EDGE</option>
            <option value="VERTEX">VERTEX</option>
          </select>
        </label>

        <label class="field">
          <span>N¬∫ do contrato</span>
          <input name="codigo" type="text" required />
        </label>

        <label class="field">
          <span>In√≠cio</span>
          <input name="vigenciaInicio" type="date" required />
        </label>

        <label class="field">
          <span>Fim</span>
          <input name="vigenciaFim" type="date" required />
        </label>

        <label class="field">
          <span>Status</span>
          <select name="status" required>
            <option value="em_andamento" selected>Em andamento</option>
            <option value="finalizado">Finalizado</option>
            <option value="pendente">Pendente</option>
          </select>
        </label>

        <label class="field">
          <span>Nome do Gerente de Projeto</span>
          <input name="gerente" type="text" required />
        </label>
      </div>
      <label class="field">
          <span>Coordenador do Projeto</span>
         <input name="coordenador" type="text" />
        </label>

      <div class="modal__footer">
        <button type="button" class="btn" id="btn-cancel">Cancelar</button>
        <button type="submit" class="btn btn-primary">Salvar</button>
      </div>
    </form>
  </dialog>

  <!-- **caminho ABSOLUTO** -->
  <script type="module" src="/scripts.js"></script>

  <!-- mant√©m o login existente -->
  <script type="module">
    import { getAuth, logout } from "/scripts.js";
    const me = getAuth();
    document.querySelector("#userName")?.textContent = me?.name || "";
    document.querySelector("#logoutBtn")?.addEventListener("click", logout);
  </script>

  <!-- Novo: persist√™ncia do Coordenador (localStorage) -->
  <script>
    (function initCoordenador() {
      const el = document.querySelector("#inp-coordenador");
      if (!el) return;
      const saved = localStorage.getItem("coordenadorNome");
      if (saved) { el.value = saved; window.coordenadorNome = saved; }
      el.addEventListener("input", () => {
        window.coordenadorNome = el.value.trim();
        localStorage.setItem("coordenadorNome", window.coordenadorNome || "");
      });
    })();
  </script>
</body>
</html>
